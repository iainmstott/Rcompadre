<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ternary Plots • Rcompadre</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ternary Plots">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rcompadre</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AgeFromStage.html">Age-from-stage analyses</a>
    </li>
    <li>
      <a href="../articles/GettingStarted.html">Getting Started with Rcompadre</a>
    </li>
    <li>
      <a href="../articles/ObtainingReferences.html">Obtaining References</a>
    </li>
    <li>
      <a href="../articles/RcompadreTidy.html">Using Rcompadre with the Tidyverse</a>
    </li>
    <li>
      <a href="../articles/TernaryPlot.html">Ternary Plots</a>
    </li>
    <li>
      <a href="../articles/VectorizingRcompadre.html">Vectorizing with Rcompadre</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Ternary Plots</h1>
                        <h4 class="author">Rob Salguero-Gomez and Owen Jones</h4>
            
            <h4 class="date">2018-12-16</h4>
      
      
      <div class="hidden name"><code>TernaryPlot.Rmd</code></div>

    </div>

    
    
<p>Here we produce a ternary plot <em>a la</em> Silvertown &amp; Franco (1993) with population growth rate as the “fourth” dimension. We will use functions from the <code>popdemo</code>, <code>Rage</code> and <code>ggtern</code> packages so first we need to load those:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Rcompadre)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(popdemo)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Rage)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggtern)</code></pre></div>
<p>Next, we will load the dataset, flag problematic data (non-ergodic matrices) and exclude them, like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(Compadre)
Compadre &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cdb_flag.html">cdb_flag</a></span>(Compadre)
Compadre &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(Compadre, MatrixSplit <span class="op">==</span><span class="st"> "Divided"</span> <span class="op">&amp;</span><span class="st"> </span>check_ergodic <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<p>We can calculate elasticities of population growth rate to changes in the matrix elements using the <code>elas</code> function from the <code>popdemo</code> package. For example, the elasticity matrix for the first <strong>A</strong> matrix in this example database looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">popdemo<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/popdemo/topics/elas">elas</a></span>(<span class="kw"><a href="../reference/CompadreMatrixMethods.html">matA</a></span>(Compadre)[[<span class="dv">1</span>]])
<span class="co">#&gt;             A1         A2         A3         A4</span>
<span class="co">#&gt; [1,] 0.1645631 0.06524073 0.02430743 0.03131899</span>
<span class="co">#&gt; [2,] 0.1208672 0.16721803 0.04892799 0.01682975</span>
<span class="co">#&gt; [3,] 0.0000000 0.07802604 0.11046976 0.02794895</span>
<span class="co">#&gt; [4,] 0.0000000 0.04335812 0.03273957 0.06818440</span></code></pre></div>
<p>We have split most matrices in COMPADRE into the constituent U, F and C matrices, which represent growth/survival, sexual reproduction and clonal reproduction respectively. Thefore, we can classify the elements of the matrix to growth processes (which we can further identify as stasis, progression, and retrogression), sexual reproduction, and clonal reproduction.</p>
<p>We can use the <code>matrixElementPerturbation</code> function from the <code>Rage</code> package to conduct this element-by-element elasticity analyis. The function outputs both sensitivities (prefixed with S) and elasticities (prefixed with E) as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Rage<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/Rage/topics/matrixElementPerturbation">matrixElementPerturbation</a></span>(<span class="dt">matU =</span> <span class="kw"><a href="../reference/CompadreMatrixMethods.html">matU</a></span>(Compadre)[[<span class="dv">1</span>]],
                                <span class="dt">matF =</span> <span class="kw"><a href="../reference/CompadreMatrixMethods.html">matF</a></span>(Compadre)[[<span class="dv">1</span>]],
                                <span class="dt">matC =</span> <span class="kw"><a href="../reference/CompadreMatrixMethods.html">matC</a></span>(Compadre)[[<span class="dv">1</span>]])
<span class="co">#&gt;    SStasis SRetrogression SProgression SFecundity SClonality   EStasis</span>
<span class="co">#&gt; 1 1.000001      0.2391149     2.365109   0.351586          0 0.5104358</span>
<span class="co">#&gt;   EProgression ERetrogression EFecundity EClonality</span>
<span class="co">#&gt; 1    0.2749906     0.07687694  0.1376969          0</span></code></pre></div>
<p>We can use a <code>for</code> loop to run through each set of matrices in turn to calculate the summed elasticity for survival (S), growth (G) and reproduction (R) like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Amats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CompadreMatrixMethods.html">matA</a></span>(Compadre)
Umats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CompadreMatrixMethods.html">matU</a></span>(Compadre)
Fmats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CompadreMatrixMethods.html">matF</a></span>(Compadre)
Cmats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CompadreMatrixMethods.html">matC</a></span>(Compadre)

output &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">S=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="ot">NA</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(Umats)),<span class="dt">G=</span><span class="ot">NA</span>,<span class="dt">R=</span><span class="ot">NA</span>,<span class="dt">lam=</span><span class="ot">NA</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(Umats)){
  temp &lt;-<span class="st"> </span>Rage<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/Rage/topics/matrixElementPerturbation">matrixElementPerturbation</a></span>(Umats[[i]],
                                          Fmats[[i]],
                                          Cmats[[i]])
  
output<span class="op">$</span>S[i] &lt;-<span class="st"> </span>temp<span class="op">$</span>EStasis <span class="op">+</span><span class="st"> </span>temp<span class="op">$</span>ERetrogression
output<span class="op">$</span>G[i] &lt;-<span class="st"> </span>temp<span class="op">$</span>EProgression
output<span class="op">$</span>R[i] &lt;-<span class="st"> </span>temp<span class="op">$</span>EFecundity <span class="op">+</span><span class="st"> </span>temp<span class="op">$</span>EClonality

<span class="co">#Calculate growth rate</span>
output<span class="op">$</span>lam[i] &lt;-<span class="st"> </span>popdemo<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/popdemo/topics/eigs">eigs</a></span>(Amats[[i]], <span class="st">"lambda"</span>)
}
<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span></code></pre></div>
<p>Let’s take a look at this output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(output)
<span class="co">#&gt;            S          G           R       lam</span>
<span class="co">#&gt; 1 0.58731274 0.27499063 0.137696890 1.0580286</span>
<span class="co">#&gt; 2 0.46765629 0.37791246 0.154347265 1.4118127</span>
<span class="co">#&gt; 3 0.97762061 0.01494911 0.007431082 0.9962044</span>
<span class="co">#&gt; 4 0.09347354 0.62204961 0.284476663 1.1241625</span>
<span class="co">#&gt; 5 0.90610402 0.09079782 0.003098288 0.9659322</span>
<span class="co">#&gt; 6 0.78256642 0.21743352 0.000000000 0.9154951</span></code></pre></div>
<p>Now we have elasticities for our three demographic processes we can place these onto a ternary plot. However, we should first scale the elasticities so that they sum to 1 - this is necessary because of possible rounding issues:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(output[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) x<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(x)))</code></pre></div>
<p>Now for the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B&lt;-ggtern<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggtern/topics/ggtern">ggtern</a></span>(<span class="dt">data=</span>output,<span class="kw"><a href="https://www.rdocumentation.org/packages/ggtern/topics/aes">aes</a></span>(<span class="dt">x =</span> R,<span class="dt">y=</span>G,<span class="dt">z=</span>S,<span class="dt">colour =</span> lam))  <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st">    </span><span class="kw">scale_color_viridis_c</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggtern/topics/theme_showarrows">theme_showarrows</a></span>() <span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggtern/topics/theme_clockwise">theme_clockwise</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="ot">NULL</span>
B</code></pre></div>
<p><img src="TernaryPlot_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Now you can try this, try using another variable, such as reactivity, or life expectancy as the “fourth” dimension instead of lambda.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Patrick Barks, Danny Buss, Roberto Salguero-Gomez, Iain Stott, Tamora James, Owen Jones, Julia Jones.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
